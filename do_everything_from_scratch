#!/bin/bash

vagrant destroy -f
vagrant up

# For the node server that runs runner requests
vagrant ssh -c "cd /vagrant; ./runner_api/install_latest_node.sh"
vagrant ssh -c "cd /vagrant; ./runner_api/install_express.sh"
vagrant ssh -c "cd /vagrant/runner_api/app; sudo npm install -g"

# For the static website
vagrant ssh -c "cd /vagrant/; sudo gem install nanoc"
vagrant ssh -c "cd /vagrant/; sudo gem install adsf"

vagrant ssh -c "sudo apt-get install docker.io -y"
vagrant ssh -c "sudo ln -s /usr/bin/docker.io /usr/bin/docker"
vagrant ssh -c "sudo docker pull ubuntu"

(
  cd build_and_run
  ./build_and_run_all
  ./run_all_with_simple_report
)
